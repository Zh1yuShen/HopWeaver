### 1. 桥接问题合成流程

桥接问题合成包含以下关键步骤：

- **桥接实体识别**：从随机选取的源文档中，系统识别可以连接不同信息上下文的桥接实体，为多跳推理提供关键枢纽
  
- **两阶段粗到细检索**：
  - 粗粒度检索：使用修改版最大边际相关性算法，平衡查询相关性、与源文档的差异性和已选文档间的多样性
  
    **多样性检索评分函数：**
    
    多样性检索使用修改版最大边际相关性（MMR）算法：
    
    $$\text{Score}(d_i) = \lambda_1 \cdot \text{sim}(q, d_i) - \lambda_2 \cdot \text{sim}(d_i, d_s) - \lambda_3 \cdot \max_{d_j \in S} \text{sim}(d_i, d_j)$$
    
    其中：
    - $q$ 是查询
    - $d_i$ 是候选文档
    - $d_s$ 是源文档  
    - $S$ 是已选文档集合
    - $\text{sim}(\cdot, \cdot)$ 表示余弦相似度
    - $\lambda_1, \lambda_2, \lambda_3$ 为权重参数，满足 $\lambda_1 + \lambda_2 + \lambda_3 = 1$
    
    此公式被 **diverse** 和 **rerank** 检索方法在粗检索阶段共同使用。
  
  - 细粒度重排序：使用经过对比学习微调的重排模型，进一步优化候选文档的排序

- **多跳问题构建**：
  - 子问题合成：分别从源文档和补充文档合成子问题，以桥接实体为中心
  - 问题合成：将子问题融合为单一连贯的多跳问题，隐含推理路径而不直接暴露桥接实体
  - 验证与迭代：确保问题满足可回答性、多跳性和无捷径约束

### 2. 比较问题合成流程

比较问题合成遵循以下步骤：

- **实体与属性识别**：从文档中识别主要实体及其3-5个简洁的事实属性值对，筛选出适合比较的属性

- **筛选与查询合成**：
  - 确保实体和属性的具体性与可比性
  - 根据源实体合成检索查询，采用直接推荐或多样化搜索策略

- **问题构建**：
  - 引导式比较：针对特定实体和属性进行精确比较
  - 开放式发现：在多个属性中寻找第一个有效的可比对
  - 合成包含两个实体信息的比较问题，如"哪个实体的属性值更高/更早/更大？"

### 3. 问题润色与质量保证

在桥接和比较问题合成过程中，系统实施严格的质量控制机制：

- **问题润色与验证模块**：
  - 评估问题的可回答性、多跳性和语言质量
  - 根据评估结果分类为通过、调整、重构或拒绝四种结果
  - 确保每个问题涉及跨文档推理并隐藏桥接实体
  - 维持流畅性，不暴露中间推理步骤

### 4. 重排模型训练与优化

系统通过模拟关键步骤合成监督信号，提高检索质量：

- **模拟反馈合成**：
  - 从桥接问题合成过程中提取成功和失败的文档样例
  - 构建对比训练三元组(查询、正例文档、负例文档)

- **对比学习优化**：
  - 使用交叉熵损失函数指导模型区分互补文档
  - 直接从下游任务成功率中获取监督信号

### 5. 多维度评估系统

系统采用全面的评估框架，确保合成问题的质量：

- **LLM-as-Judge评估**：
  - 使用大型语言模型作为评判，采用李克特量表评估每个问题
  - 实现自一致性评估方法，确保评估结果的稳定性和可重现性
  - 通过多次重复评估同一输入，分析评估结果的一致性

- **可回答性和难度评估**：
  - **Q-Only条件**：求解器仅接收问题，测试问题的基线可回答性，主要依赖求解器的内部知识和推理能力
  - **Q+Docs条件**：求解器接收问题及所有支撑文档，模拟黄金检索场景，评估问题在获得必要证据时的可回答性
  - **性能差异分析**：通过Q-Only到Q+Docs的性能提升来判断问题是否具有挑战性，需要跨文档推理而非仅依赖预训练知识

- **证据可获取性评估**：
  - **检索质量评估**：使用多种检索方法获取top-k文档，评估合成问题的证据在语料库中的可获取程度
  - **多维检索指标**：记录MAP（平均精度）、RECALL@k（前k召回率）、NDCG@k（归一化折扣累积增益）和Support F1等指标
  - **证据完整性验证**：确保合成的问题具有完整的证据支撑，避免无法回答的问题进入最终数据集 